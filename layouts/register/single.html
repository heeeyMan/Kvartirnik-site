{{ define "main" }}
<div class="pa3 pa4-ns w-100 w-90-ns center">
  <p id="formMessage" class="f4 tc mb4" style="display:none;"></p>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ø–Ω–¥–µ–∫—Å —Ñ–æ—Ä–º—ã -->
  <div class="bg-near-white pa3 br3 shadow-4 tc">
    <!-- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–¥ –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º -->
    <script src="https://forms.yandex.ru/_static/embed.js"></script>
    <iframe 
      src="https://forms.yandex.ru/u/68bd7ba5d046889d65bd631f?iframe=1" 
      frameborder="0" 
      name="ya-form-68bd7ba5d046889d65bd631f" 
      width="100%" 
      height="800"
      style="border: none; border-radius: 8px; min-height: 700px;"
      onload="window.onYandexFormLoad()"
      onerror="window.onYandexFormError()"
    ></iframe>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingIndicator" class="mt3">
      <div class="spinner" style="font-size: 2rem; color: #5a1700;">‚è≥</div>
      <p class="f4 mt2">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏...</p>
    </div>
  </div>

  <!-- –†–µ–∑–µ—Ä–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞ -->
  <div class="tc mt4">
    <p class="f5 mb2">–ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–æ–π:</p>
    <a href="https://forms.yandex.ru/u/68bd7ba5d046889d65bd631f" 
       target="_blank" 
       class="ph4 pv3 bg-blue white br2 f5 fw6 no-underline dib">
      üìã –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
    </a>
  </div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π iframe
window.onYandexFormLoad = function() {
  console.log('‚úÖ –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
  hideLoadingIndicator();
  showMessage('–§–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é', 'success');
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
  saveFormEvent('form_loaded');
  
  // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—ã—Å–æ—Ç—É iframe
  adjustIframeHeight();
};

window.onYandexFormError = function() {
  console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º—ã');
  showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ä–º—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é —Å—Å—ã–ª–∫—É.', 'error');
  hideLoadingIndicator();
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã—Å–æ—Ç—ã iframe
function adjustIframeHeight() {
  const iframe = document.querySelector('iframe');
  if (!iframe) return;
  
  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  if (window.innerWidth < 768) {
    iframe.style.height = '900px';
  } else {
    iframe.style.height = '800px';
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
function showMessage(text, type = 'info') {
  const messageElement = document.getElementById('formMessage');
  if (!messageElement) return;
  
  messageElement.textContent = text;
  messageElement.style.display = 'block';
  
  const colors = {
    success: '#38a169',
    error: '#e53e3e',
    warning: '#dd6b20',
    info: '#3182ce'
  };
  
  messageElement.style.color = colors[type] || 'black';
  messageElement.style.padding = '16px';
  messageElement.style.borderRadius = '8px';
  messageElement.style.margin = '20px 0';
  messageElement.style.fontSize = '1.1rem';
  messageElement.style.backgroundColor = type === 'info' ? '#f0f9ff' : 'transparent';
  messageElement.style.border = `2px solid ${colors[type]}30`;
  
  if (type === 'success') {
    setTimeout(() => {
      messageElement.style.display = 'none';
    }, 5000);
  }
}

function hideLoadingIndicator() {
  const loadingIndicator = document.getElementById('loadingIndicator');
  if (loadingIndicator) {
    loadingIndicator.style.display = 'none';
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function saveFormEvent(eventType) {
  try {
    const events = JSON.parse(localStorage.getItem('form_events') || '[]');
    events.push({
      type: eventType,
      timestamp: new Date().toISOString(),
      date: new Date().toLocaleDateString('ru-RU'),
      time: new Date().toLocaleTimeString('ru-RU')
    });
    
    localStorage.setItem('form_events', JSON.stringify(events));
    updateStats();
    
  } catch (error) {
    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è:', error);
  }
}

function updateStats() {
  try {
    const events = JSON.parse(localStorage.getItem('form_events') || '[]');
    const submissions = events.filter(event => event.type === 'form_submit');
    const loads = events.filter(event => event.type === 'form_loaded');
    
    const statsText = document.getElementById('statsText');
    if (statsText) {
      statsText.textContent = `–ó–∞–≥—Ä—É–∑–æ–∫: ${loads.length} | –û—Ç–ø—Ä–∞–≤–æ–∫: ${submissions.length}`;
    }
    
  } catch (error) {
    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
  }
}

function clearStats() {
  if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?')) {
    localStorage.removeItem('form_events');
    updateStats();
    showMessage('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—â–µ–Ω–∞', 'success');
  }
}

// –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º
window.addEventListener('message', function(event) {
  try {
    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ origin
    if (event.origin !== 'https://forms.yandex.ru') return;
    
    console.log('üì® –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º:', event.data);
    
    if (event.data && typeof event.data === 'object') {
      switch (event.data.type) {
        case 'formSubmit':
          showMessage('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!', 'success');
          saveFormEvent('form_submit');
          break;
        case 'formError':
          showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
          break;
        case 'formHeightChange':
          const iframe = document.querySelector('iframe');
          if (iframe && event.data.height) {
            iframe.style.height = Math.max(event.data.height, 700) + 'px';
          }
          break;
      }
    }
  } catch (error) {
    console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
  }
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
setTimeout(() => {
  hideLoadingIndicator();
}, 15000);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
window.addEventListener('resize', adjustIframeHeight);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
  console.log('üöÄ –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
  updateStats();
  
  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏
  window.getFormStats = function() {
    const events = JSON.parse(localStorage.getItem('form_events') || '[]');
    console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–æ—Ä–º—ã:', events);
    return events;
  };
  
  window.reloadForm = function() {
    const iframe = document.querySelector('iframe');
    if (iframe) {
      iframe.src = iframe.src;
      showMessage('–§–æ—Ä–º–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...', 'info');
    }
  };
  
  window.adjustIframeSize = function(height = 800) {
    const iframe = document.querySelector('iframe');
    if (iframe) {
      iframe.style.height = height + 'px';
      showMessage(`–í—ã—Å–æ—Ç–∞ —Ñ–æ—Ä–º—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${height}px`, 'info');
    }
  };
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è
function trackManualSubmission() {
  saveFormEvent('form_submit');
  showMessage('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø–∏—Å–∞–Ω–∞!', 'success');
}
</script>

<style>
/* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
.bg-near-white {
  background-color: #fafafa;
}

.br3 {
  border-radius: 16px;
}

.shadow-4 {
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ */
.spinner {
  animation: spin 1.5s linear infinite;
  display: inline-block;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1200px) {
  .w-90-ns {
    width: 95% !important;
  }
}

@media (max-width: 768px) {
  .pa4-ns {
    padding: 1rem;
  }
  
  iframe {
    height: 900px !important;
    min-height: 800px !important;
  }
  
  h1.f2 {
    font-size: 1.8rem !important;
  }
}

@media (max-width: 480px) {
  iframe {
    height: 1000px !important;
    min-height: 900px !important;
  }
  
  h1.f2 {
    font-size: 1.6rem !important;
  }
  
  .ph4.pv3 {
    padding: 0.75rem 1.5rem !important;
  }
}

/* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
#formMessage, #loadingIndicator {
  transition: all 0.3s ease;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.bg-light-gray {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border: 2px dashed #dee2e6;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è iframe */
iframe {
  transition: height 0.3s ease;
  background: white;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
.bg-blue {
  background: linear-gradient(135deg, #1e6fba 0%, #2b8cc4 100%);
  transition: all 0.3s ease;
}

.bg-blue:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(43, 140, 196, 0.4);
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–ø–∏–Ω–Ω–µ—Ä */
#loadingIndicator {
  padding: 2rem;
}
</style>

{{ end }}
