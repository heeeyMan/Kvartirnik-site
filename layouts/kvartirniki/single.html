{{ define "main" }}
<div class="pa4 pa5-ns">
  <article class="kvartirnik-article measure-wide center">
    
    <!-- –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ -->
    <div class="mb4">
      <button class="back-btn f6 ph3 pv2 br2 bn pointer" 
              onclick="goBack()"
              style="background-color: #ffffff; color: rgb(0, 0, 0); border: none;">
        ‚Üê –ù–∞–∑–∞–¥
      </button>
    </div>

    <!-- –ë–ª–æ–∫–∏ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è, –ú–µ—Å—Ç–æ -->
    <div class="info-sections flex flex-wrap mb5" style="gap: 2rem;">
      <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è -->
      {{ if .Params.date }}
      <section class="date-time-section pa3 br3 shadow-1" style="background: white; min-width: 250px; flex: 1;">
        <h2 class="f4 mb3 tc" style="color: #34495e;">
          <span class="icon-calendar"></span> –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
        </h2>
        <div class="tc">
          <p class="f5 b mb1" style="color: #2c3e50;">{{ dateFormat "02 January 2006" .Params.date }}</p>
          <p class="f5" style="color: #7f8c8d;">
            {{ if .Params.time }}{{ .Params.time }}{{ else }}{{ dateFormat "15:04" .Params.date }}{{ end }}
          </p>
        </div>
      </section>
      {{ end }}

      <!-- –ú–µ—Å—Ç–æ -->
      {{ if .Params.location }}
      <section class="location-section pa3 br3 shadow-1" style="background: white; min-width: 250px; flex: 1;">
        <h2 class="f4 mb3 tc" style="color: #34495e;">
          <span class="custom-location-icon"></span> –ú–µ—Å—Ç–æ
        </h2>
        <div class="tc">
          <p class="f5 b mb1" style="color: #2c3e50;">{{ .Params.location }}</p>
          {{ if .Params.address }}
          <p class="f6 mb2" style="color: #7f8c8d;">{{ .Params.address }}</p>
          {{ end }}
          {{ if .Params.yandex_maps_link }}
            <a href="{{ .Params.yandex_maps_link }}" 
              target="_blank" 
              class="f6 ph3 pv2 dib br2 no-underline pointer"
              style="color: #8B4513 !important; background-color: #ffffff !important; border: 1px solid #8B4513; transition: all 0.3s ease;"
              onmouseover="this.style.backgroundColor='#8B4513'; this.style.color='white'"
              onmouseout="this.style.backgroundColor='#ffffff'; this.style.color='#8B4513'">
              –û—Ç–∫—Ä—ã—Ç—å –≤ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö
            </a>
          {{ end }}
        </div>
      </section>
      {{ end }}
    </div>
    
    <!-- –ü—Ä–æ–≥—Ä–∞–º–º–∞ -->
    {{ if .Params.program }}
    <section class="program-section mb5">
      <h2 class="f3 mb3 tc" style="color: #34495e;">üìÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤–µ—á–µ—Ä–∞</h2>
      <div class="program-list flex flex-column items-center">
        {{ range .Params.program }}
        <div class="program-item flex items-center mb2" style="max-width: 400px; width: 60%;">
          <span class="program-time f5 b mr3" style="min-width: 60px; color: #2c3e50;">{{ .time }}</span>
          <span class="program-title f5">{{ .title }}</span>
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}
    
    <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–º—Å—è —Å–ø–∏—Å–∫–æ–º -->
    {{ if .Params.participants }}
    <section class="participants-section mb5">
      <h2 class="f3 mb4 tc" style="color: #34495e;">üé§ –£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
      <div class="participants-list">
        <!-- –ü–µ—Ä–≤—ã–µ —Ç—Ä–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–µ) -->
        {{ range first 3 .Params.participants }}
        <div class="participant-card pa3 mb3 br3 shadow-1">
          <div class="participant-header flex items-center justify-between">
            <h3 class="f4 mb0" style="color: #2c3e50;">{{ .name }}</h3>
            <span class="f6 gray">{{ .instrument }}</span>
          </div>
          
          <div class="songs-container">
            <ul class="songs-list list pl0 mt2">
              {{ range .songs }}
              <li class="song-item mb1 f6">üéµ {{ . }}</li>
              {{ end }}
            </ul>
          </div>
        </div>
        {{ end }}
        
        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (—Å–∫—Ä—ã—Ç—ã–µ) -->
        {{ if gt (len .Params.participants) 3 }}
        <div class="participants-collapsible" style="display: none;">
          {{ range after 3 .Params.participants }}
          <div class="participant-card pa3 mb3 br3 shadow-1">
            <div class="participant-header flex items-center justify-between">
              <h3 class="f4 mb0" style="color: #2c3e50;">{{ .name }}</h3>
              <span class="f6 gray">{{ .instrument }}</span>
            </div>
            
            <div class="songs-container">
              <ul class="songs-list list pl0 mt2">
                {{ range .songs }}
                <li class="song-item mb1 f6">üéµ {{ . }}</li>
                {{ end }}
              </ul>
            </div>
          </div>
          {{ end }}
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å -->
        <div class="tc mt2">
          <button class="show-more-participants-btn f6 ph4 pv2 br2 bn pointer" 
                  onclick="toggleParticipants(this)"
                  style="background-color: #854e22; color: white;"
                  data-hidden-count="{{ sub (len .Params.participants) 3 }}">
            –ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë {{ sub (len .Params.participants) 3 }} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚ñº
          </button>
        </div>
        {{ end }}
      </div>
    </section>
    {{ else }}
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ—Ç -->
<section class="participants-section mb5">
  <h2 class="f3 mb3 tc" style="color: #34495e;">üìù –ò–¥–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
  <div class="tc pa5 bg-light-gray br3">
    <p class="f4 gray i mb4">–û—Ç–∫—Ä—ã—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –∑—Ä–∏—Ç–µ–ª–µ–π</p>
    <a href="/register/" class="dib ph4 pv3 bg-yellow white br2 f3 fw6 no-underline hover-bg-dark-blue">
          –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
        </a>
  </div>
</section>
    {{ end }}

    <!-- –§–æ—Ä–º–∞—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
    <section class="event-format-section mb5">
      <h2 class="f4 mb3 tc" style="color: #34495e;">
        <span class="icon-format"></span> –§–æ—Ä–º–∞—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
      </h2>
      <div class="event-format-content pa3 br3 shadow-1" style="background: white; line-height: 1.6; color: #2c3e50;">
        {{ if .Params.eventFormat }}
          {{ .Params.eventFormat | markdownify }}
        {{ else }}
          <p class="f4 gray i tc">–§–æ—Ä–º–∞—Ç –ø–æ–∫–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω</p>
        {{ end }}
      </div>
    </section>

    <!-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ -->
    {{ if .Params.photos }}
    <section class="kvartirnik-photos mb5">
      <h2 class="f3 mb4 tc" style="color: #34495e;">üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
      <div class="photos-container">
        <div class="photos-grid" id="photosGrid" data-photos='{{ .Params.photos | jsonify }}'>
          {{ range $index, $photo := .Params.photos }}
          <div class="photo-item {{ if ge $index 9 }}photos-hidden{{ end }}">
            <img src="{{ $photo }}" 
                 alt="–§–æ—Ç–æ —Å –∫–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫–∞ {{ $.Title }}" 
                 class="db w-100 br3 photo-thumbnail"
                 onclick="openModal({{ $index }})">
          </div>
          {{ end }}
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
        {{ if gt (len .Params.photos) 9 }}
        <div class="tc mt4">
          <button class="show-more-photos-btn f6 ph4 pv2 br2 bn pointer" 
                  onclick="togglePhotos(this)"
                  style="background-color: #854e22; color: white;"
                  data-hidden-count="{{ sub (len .Params.photos) 9 }}"
                  data-expanded="false">
            –ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë {{ sub (len .Params.photos) 9 }} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π ‚ñº
          </button>
        </div>
        {{ end }}
      </div>
    </section>
    {{ else }}
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–µ—Ç -->
    <section class="kvartirnik-photos mb5">
      <h2 class="f3 mb4 tc" style="color: #34495e;">üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
      <div class="tc pa5 bg-light-gray br3">
        <p class="f4 gray i">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–æ–∫–∞ —á—Ç–æ –Ω–µ—Ç :(</p>
      </div>
    </section>
    {{ end }}

  </article>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
<div id="photoModal" class="modal" style="display: none;">
  <span class="modal-close" onclick="closeModal()">&times;</span>
  <img class="modal-content" id="modalImage">
  <div class="modal-caption" id="modalCaption"></div>
  
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <a class="modal-prev" onclick="changePhoto(-1)">&#10094;</a>
  <a class="modal-next" onclick="changePhoto(1)">&#10095;</a>
</div>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —Ñ–æ—Ç–æ–≥–∞–ª–µ—Ä–µ–∏ -->
<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥ */
.back-btn {
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.back-btn:hover {
  background-color: #5a6268 !important;
  transform: translateX(-2px);
}

/* –°—Ç–∏–ª—å –¥–ª—è –∏–∫–æ–Ω–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è */
.icon-format {
  display: inline-block;
  width: 24px;
  height: 24px;
  position: relative;
  margin-right: 8px;
  vertical-align: middle;
  background: linear-gradient(135deg, #b68a12, #694f03);
  border-radius: 4px;
}

.icon-format::before {
  content: 'üìñ';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 16px;
  color: white;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è */
.event-format-content ul {
  list-style: none;      /* —É–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫—Ä—É–∂–∫–∏ */
  padding-left: 0;       /* —É–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø */
  margin: 0;
}

.event-format-content li {
  margin-bottom: 0.75rem;
  padding-left: 2rem;
  position: relative;
  font-size: 1rem;
}

.event-format-content li::before {
  content: "üéµ";         /* –∏–∫–æ–Ω–∫–∞ –≤–º–µ—Å—Ç–æ –±—É–ª–ª–µ—Ç–∞ */
  position: absolute;
  left: 0;
  top: 0;
  font-size: 1.2rem;
}


/* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–æ–≤ –î–∞—Ç–∞ –∏ –ú–µ—Å—Ç–æ */
.info-sections {
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
}

.date-time-section, .location-section {
  background: white;
  transition: all 0.3s ease;
  border: 1px solid #e1e8ed;
}

.date-time-section:hover, .location-section:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15) !important;
}

.location-section a:hover {
  background-color: #b76111 !important;
  transform: translateY(-1px);
}

/* –ö—Ä–∞—Å–∏–≤—ã–π –∑–Ω–∞—á–æ–∫ –ª–æ–∫–∞—Ü–∏–∏ */
.custom-location-icon {
  display: inline-block;
  width: 24px;
  height: 24px;
  position: relative;
  margin-right: 8px;
  vertical-align: middle;
}

.custom-location-icon::before {
  content: '';
  position: absolute;
  width: 18px;
  height: 18px;
  background: linear-gradient(135deg, #dea30e, #654000);
  border-radius: 50% 50% 50% 0;
  transform: rotate(-45deg);
  top: 0;
  left: 0;
  box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
}

.custom-location-icon::after {
  content: '';
  position: absolute;
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  top: 5px;
  left: 5px;
  transform: rotate(45deg);
  z-index: 2;
}

/* –ó–Ω–∞—á–æ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
.icon-calendar {
  display: inline-block;
  width: 24px;
  height: 24px;
  position: relative;
  margin-right: 8px;
  vertical-align: middle;
  background: linear-gradient(135deg, #fa9b0c, #795100);
  border-radius: 4px;
  overflow: hidden;
}

.icon-calendar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: #ec8600;
}

.icon-calendar::after {
  content: '32';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 10px;
  font-weight: bold;
}

/* –°–¢–ê–†–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ö–ê–†–¢–û–ß–ï–ö –£–ß–ê–°–¢–ù–ò–ö–û–í */
.participant-card {
  background: white;
  border-left: 4px solid #e17800;
  transition: all 0.3s ease;
}

.participant-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.15);
}

.participant-header {
  border-bottom: 1px solid #f1f1f1;
  padding-bottom: 0.5rem;
  margin-bottom: 0.5rem;
}

.song-item {
  padding: 0.3rem 0;
  border-bottom: 1px solid #f8f9fa;
  transition: background-color 0.2s ease;
}

.song-item:hover {
  background-color: #f8f9fa;
  border-radius: 4px;
}

.song-item:last-child {
  border-bottom: none;
}

.show-more-participants-btn {
  transition: all 0.3s ease;
}

.show-more-participants-btn:hover {
  background-color: #936c23 !important;
  transform: translateY(-2px);
}

.participants-collapsible {
  transition: all 0.3s ease;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –Ω–∞–±–æ—Ä–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */
.bg-light-gray {
  background-color: #f8f9fa;
}

/* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –§–û–¢–û–ì–ê–õ–ï–†–ï–ò */
.photos-container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
}

.photos-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  margin-bottom: 1rem;
}

.photo-item {
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  transition: all 0.3s ease;
  cursor: pointer;
  aspect-ratio: 4/3;
}

.photo-thumbnail {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: all 0.3s ease;
}

.photo-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}

.photo-item:hover .photo-thumbnail {
  transform: scale(1.1);
}

/* –°–∫—Ä—ã—Ç—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ */
.photos-hidden {
  display: none;
}

.photos-grid.expanded .photos-hidden {
  display: block;
  animation: fadeIn 0.5s ease;
}

/* –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ */
.show-more-photos-btn {
  transition: all 0.3s ease;
  margin-top: 1rem;
}

.show-more-photos-btn:hover {
  background-color: #936c23 !important;
  transform: translateY(-2px);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  padding-top: 50px;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  animation: fadeIn 0.3s ease;
}

.modal-content {
  display: block;
  margin: 0 auto;
  max-width: 90%;
  max-height: 80vh;
  object-fit: contain;
}

.modal-close {
  position: absolute;
  top: 15px;
  right: 35px;
  color: #fff;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
  transition: color 0.3s ease;
}

.modal-close:hover {
  color: #ccc;
}

.modal-caption {
  text-align: center;
  color: #fff;
  padding: 10px;
  font-size: 16px;
}

.modal-prev,
.modal-next {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: white;
  font-size: 30px;
  font-weight: bold;
  padding: 16px;
  cursor: pointer;
  user-select: none;
  transition: 0.3s;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 50%;
}

.modal-prev:hover,
.modal-next:hover {
  background-color: rgba(0, 0, 0, 0.8);
}

.modal-prev {
  left: 20px;
}

.modal-next {
  right: 20px;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideDown {
  from { 
    opacity: 0;
    max-height: 0;
    transform: translateY(-10px);
  }
  to { 
    opacity: 1;
    max-height: 2000px;
    transform: translateY(0);
  }
}

.participants-collapsible.show {
  display: block !important;
  animation: slideDown 0.5s ease;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
  .photos-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1.2rem;
  }
}

@media (max-width: 768px) {
  .info-sections {
    flex-direction: column;
    gap: 1rem;
  }
  
  .date-time-section, .location-section {
    min-width: auto;
  }
  
  .photos-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
  
  .modal-content {
    max-width: 95%;
  }
  
  .modal-prev,
  .modal-next {
    font-size: 24px;
    padding: 12px;
  }
  
  .modal-close {
    font-size: 30px;
    right: 20px;
  }
}

@media (max-width: 480px) {
  .photos-grid {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }
  
  .photo-item {
    aspect-ratio: 3/2;
  }
}
</style>

<!-- JavaScript -->
<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥
function goBack() {
  window.history.back();
}

// –î–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
function toggleParticipants(button) {
  const container = button.parentElement.previousElementSibling;
  const isExpanded = container.classList.contains('show');
  const hiddenCount = button.getAttribute('data-hidden-count');
  
  if (isExpanded) {
    container.classList.remove('show');
    button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë ' + hiddenCount + ' —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚ñº';
    button.style.backgroundColor = '#3498db';
  } else {
    container.classList.add('show');
    button.textContent = '–°–∫—Ä—ã—Ç—å ‚ñ≤';
    button.style.backgroundColor = '#e74c3c';
  }
}

// –î–ª—è —Ñ–æ—Ç–æ–≥–∞–ª–µ—Ä–µ–∏ - –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ
function togglePhotos(button) {
  const photosGrid = document.getElementById('photosGrid');
  const isExpanded = photosGrid.classList.contains('expanded');
  const hiddenCount = button.getAttribute('data-hidden-count');
  
  if (isExpanded) {
    photosGrid.classList.remove('expanded');
    button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë ' + hiddenCount + ' —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π ‚ñº';
    button.style.backgroundColor = '#3498db';
    button.setAttribute('data-expanded', 'false');
    
    // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–∞—á–∞–ª—É –≥–∞–ª–µ—Ä–µ–∏
    photosGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
  } else {
    photosGrid.classList.add('expanded');
    button.textContent = '–°–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ‚ñ≤';
    button.style.backgroundColor = '#e74c3c';
    button.setAttribute('data-expanded', 'true');
  }
}

// –î–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ñ–æ—Ç–æ–≥–∞–ª–µ—Ä–µ–∏
let currentPhotoIndex = 0;
let photos = [];

function openModal(index) {
  const photosContainer = document.getElementById('photosGrid');
  photos = JSON.parse(photosContainer.getAttribute('data-photos'));
  
  currentPhotoIndex = index;
  const modal = document.getElementById('photoModal');
  const modalImg = document.getElementById('modalImage');
  const modalCaption = document.getElementById('modalCaption');
  
  modal.style.display = 'block';
  modalImg.src = photos[currentPhotoIndex];
  modalCaption.textContent = `–§–æ—Ç–æ ${currentPhotoIndex + 1} –∏–∑ ${photos.length}`;
  
  // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  const modal = document.getElementById('photoModal');
  modal.style.display = 'none';
  
  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
  document.body.style.overflow = 'auto';
}

function changePhoto(direction) {
  if (!photos.length) {
    const photosContainer = document.getElementById('photosGrid');
    photos = JSON.parse(photosContainer.getAttribute('data-photos'));
  }
  
  currentPhotoIndex += direction;
  
  // –ó–∞—Ü–∏–∫–ª–∏–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
  if (currentPhotoIndex >= photos.length) {
    currentPhotoIndex = 0;
  } else if (currentPhotoIndex < 0) {
    currentPhotoIndex = photos.length - 1;
  }
  
  const modalImg = document.getElementById('modalImage');
  const modalCaption = document.getElementById('modalCaption');
  
  modalImg.src = photos[currentPhotoIndex];
  modalCaption.textContent = `–§–æ—Ç–æ ${currentPhotoIndex + 1} –∏–∑ ${photos.length}`;
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
document.getElementById('photoModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeModal();
  }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∞–≤–∏—à–µ ESC
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeModal();
  }
  if (e.key === 'ArrowLeft') {
    changePhoto(-1);
  }
  if (e.key === 'ArrowRight') {
    changePhoto(1);
  }
});

// –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –ø–ª–∞–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã
function preloadImages() {
  const photosContainer = document.getElementById('photosGrid');
  if (photosContainer) {
    const photos = JSON.parse(photosContainer.getAttribute('data-photos'));
    photos.forEach(photo => {
      const img = new Image();
      img.src = photo;
    });
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('load', preloadImages);
</script>
{{ end }}