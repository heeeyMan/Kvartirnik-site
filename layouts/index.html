{{ define "main" }}
<div class="pa3 pa4-ns w-100 w-70-ns center">
  
  <!-- –ë–ª–æ–∫ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫–æ–º -->
  {{ $kvartirniki := where site.RegularPages "Section" "kvartirniki" }}
  {{ $now := now }}
  
  {{ if $kvartirniki }}
    <!-- –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–π –±—É–¥—É—â–∏–π –∫–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫ -->
    {{ $futureKvartirniki := where $kvartirniki "Date" "ge" $now }}
    {{ $nearestFutureKvartirnik := cond (gt (len $futureKvartirniki) 0) 
        (index ($futureKvartirniki.ByDate) 0) 
        nil }}
    
    <!-- –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—à–µ–¥—à–∏–π –∫–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫ -->
    {{ $pastKvartirniki := where $kvartirniki "Date" "lt" $now }}
    {{ $lastPastKvartirnik := cond (gt (len $pastKvartirniki) 0)
        (index ($pastKvartirniki.ByDate.Reverse) 0)
        nil }}

<!-- ===== –£–ü–†–û–©–ï–ù–ù–´–ô –ë–õ–û–ö: –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –ó–ê–ì–û–õ–û–í–û–ö ===== -->
{{ if $nearestFutureKvartirnik }}
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º - –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ Google –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
  <h1 class="f1 tc mb3" style="color: #5a1700;">
    <a href="https://calendar.google.com/calendar/r/eventedit?text={{ $nearestFutureKvartirnik.Title | urlquery }}&details=–ö–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫ {{ $nearestFutureKvartirnik.Date.Format "02.01.2006" }} –≤ {{ $nearestFutureKvartirnik.Params.time }}&location={{ $nearestFutureKvartirnik.Params.location | urlquery }}"
       target="_blank"
       class="no-underline hover-black-70"
       style="color: #5a1700 !important; cursor: pointer; text-decoration: none;">
      {{ $nearestFutureKvartirnik.Date.Format "02.01.2006" }} | {{ $nearestFutureKvartirnik.Date.Format "15:04" }}
    </a>
  </h1>
  
  <!-- –ë–ª–æ–∫ —Å –ª–æ–∫–∞—Ü–∏–µ–π - –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç -->
  {{ if $nearestFutureKvartirnik.Params.location }}
    <h2 class="f2 tc mb3" style="color: #5a1700;">
      {{ if $nearestFutureKvartirnik.Params.yandex_maps_link }}
        <a href="{{ $nearestFutureKvartirnik.Params.yandex_maps_link }}" 
           target="_blank" 
           class="no-underline black hover-black-70 flex items-center justify-center"
           style="color: #5a1700 !important;">
      {{ else }}
        <div class="flex items-center justify-center">
      {{ end }}
      
          <!-- SVG –∏–∫–æ–Ω–∫–∞ –ª–æ–∫–∞—Ü–∏–∏ -->
          <svg class="dib mr2" fill="currentColor" viewBox="0 0 24 24" style="width: 62px; height: 62px; vertical-align: middle;">
            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
          </svg>
          
          <!-- –ê–¥—Ä–µ—Å –ª–æ–∫–∞—Ü–∏–∏ -->
          <span style="font-family: 'Courier New', monospace; font-weight: normal;">
            {{ $nearestFutureKvartirnik.Params.location }}
          </span>
      
      {{ if $nearestFutureKvartirnik.Params.yandex_maps_link }}
        </a>
      {{ else }}
        </div>
      {{ end }}
    </h2>
  {{ end }}
  
  <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ / —Ç–µ–∫—Å—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div class="tc mb4">
    {{ with $nearestFutureKvartirnik.Params.deadline_reg_date }}
      {{ $deadline := time . }}
      {{ if lt now $deadline }}
        <a href="/register/" class="dib ph4 pv3 bg-yellow white br2 f3 fw6 no-underline hover-bg-dark-blue">
          –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
        </a>
      {{ else }}
        <p class="f2 tc reg-finish fw6">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</p>
      {{ end }}
    {{ else }}
      <!-- –ï—Å–ª–∏ –≤ .Params –Ω–µ—Ç deadline_reg_date, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
      <a href="/register/" class="dib ph4 pv3 bg-yellow white br2 f3 fw6 no-underline hover-bg-dark-blue">
        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
      </a>
    {{ end }}
  </div>
{{ else }}
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–≥–¥–∞ –Ω–µ—Ç –±—É–¥—É—â–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
  <h1 class="f1 tc mb4" style="color: rgb(192, 143, 6);">–ê–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –Ω–µ—Ç</h1>
{{ end }}

    <!-- ===== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ ===== -->
    {{ if $nearestFutureKvartirnik }}
      <section class="main-event">

        {{ with $nearestFutureKvartirnik.Params.deadline_reg_date }}
          {{ $deadline := time . }}
          {{ if lt now $deadline }}
            <div class="upcoming-message mb4">
              <p class="f4 tc ma0">–£–∂–µ —Å–∫–æ—Ä–æ —Å–æ—Å—Ç–æ–∏—Ç—Å—è –æ—á–µ—Ä–µ–¥–Ω–æ–π –∫–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫!</p>
              <p class="f4 tc ma0">–ë—É–¥–µ–º –æ—á–µ–Ω—å —Ä–∞–¥—ã –≤–∞—Å –≤–∏–¥–µ—Ç—å –Ω–∞ –Ω–∞—à–µ–º —Ç–≤–æ—Ä—á–µ—Å–∫–æ–º –≤–µ—á–µ—Ä–µ ...</p>
            </div>
          {{ else }}
            <div class="upcoming-message mb4">
              <p class="f4 tc ma0">–ù–æ –º—ã –±—É–¥–µ–º —Ä–∞–¥—ã, –µ—Å–ª–∏ –≤—ã –ø—Ä–∏–¥—ë—Ç–µ!
                <br>(–¥–∞–∂–µ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ... —Ç–æ–ª—å–∫–æ –ø—Å—Å—Å ...)</p>
            </div>
          {{ end }}
        {{ else }}
          <div class="upcoming-message mb4">
            <p class="f4 tc ma0">–£–∂–µ —Å–∫–æ—Ä–æ —Å–æ—Å—Ç–æ–∏—Ç—Å—è –æ—á–µ—Ä–µ–¥–Ω–æ–π –∫–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫!</p>
            <p class="f4 tc ma0">–ë—É–¥–µ–º –æ—á–µ–Ω—å —Ä–∞–¥—ã –≤–∞—Å –≤–∏–¥–µ—Ç—å –Ω–∞ –Ω–∞—à–µ–º —Ç–≤–æ—Ä—á–µ—Å–∫–æ–º –≤–µ—á–µ—Ä–µ ...</p>
          </div>
        {{ end }}

        <a href="{{ $nearestFutureKvartirnik.RelPermalink }}" class="link black dim">
          <div class="event-card">
            <div class="event-image">
              {{ with $nearestFutureKvartirnik.Params.featured_image }}
                <img src="{{ . }}" alt="{{ $nearestFutureKvartirnik.Title }}" class="w-100">
              {{ else }}
                <div class="placeholder-image">–§–æ—Ç–æ –∞—Ñ–∏—à–∏</div>
              {{ end }}
            </div>
            
            <div class="event-content">
              <h3 class="f3 ma0 mb2">{{ $nearestFutureKvartirnik.Title }}</h3>
              <div class="event-date mb2">
                {{ $nearestFutureKvartirnik.Date.Format "2 January 2006" }}
                {{ with $nearestFutureKvartirnik.Params.time }}
                  ‚Ä¢ <span class="event-time">{{ . }}</span>
                {{ end }}
                <span class="status-badge future">–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç</span>
              </div>
              <p class="event-excerpt ma0">
                {{ $nearestFutureKvartirnik.Summary | plainify | truncate 120 }}
              </p>
            </div>
          </div>
        </a>
      </section>

    {{ else if $lastPastKvartirnik }}
      <section class="main-event">
        <div class="no-upcoming-events mb4">
          <p class="f4 tc ma0">–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã :(</p>
          <p class="f4 tc ma0">–ê –ø–æ–∫–∞ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ –ø—Ä–æ—à–ª–∞ –Ω–∞—à–∞ –∫—Ä–∞–π–Ω—è—è –≤—Å—Ç—Ä–µ—á–∞</p>
        </div>
        
        <a href="{{ $lastPastKvartirnik.RelPermalink }}" class="link black dim">
          <div class="event-card">
            <div class="event-image">
              {{ with $lastPastKvartirnik.Params.featured_image }}
                <img src="{{ . }}" alt="{{ $lastPastKvartirnik.Title }}" class="w-100">
              {{ else }}
                <div class="placeholder-image">–§–æ—Ç–æ –∞—Ñ–∏—à–∏</div>
              {{ end }}
            </div>
            
            <div class="event-content">
              <h3 class="f3 ma0 mb2">{{ $lastPastKvartirnik.Title }}</h3>
              <div class="event-date mb2">
                {{ $lastPastKvartirnik.Date.Format "2 January 2006" }}
                {{ with $lastPastKvartirnik.Params.time }}
                  ‚Ä¢ <span class="event-time">{{ . }}</span>
                {{ end }}
                <span class="status-badge past">–°–æ—Å—Ç–æ—è–ª—Å—è</span>
              </div>
              <p class="event-excerpt ma0">
                {{ $lastPastKvartirnik.Summary | plainify | truncate 120 }}
              </p>
            </div>
          </div>
        </a>
      </section>
    {{ end }}

  {{ else }}
    <!-- –ù–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –∫–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫–æ–≤ –≤–æ–æ–±—â–µ -->
    <h1 class="f1 tc mb4">–ö–∞–º–∏–Ω</h1>
    
    <div class="no-events tc pa5">
      <h2 class="f2 mb3">–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –∫–≤–∞—Ä—Ç–∏—Ä–Ω–∏–∫–∏ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã</h2>
      <p class="f4 mb4">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ –Ω–∞—à–∏—Ö —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö</p>
      <div class="event-placeholder">
        <div class="placeholder-icon">üéµ</div>
        <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–≤—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö</p>
      </div>
    </div>
  {{ end }}

  <!-- ===== –ö–ù–û–ü–ö–ò –°–û–¶–°–ï–¢–ï–ô ===== -->
  <div class="social-buttons tc">
    <h3 class="f3 mb3 social-header">–ú—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö</h3>
    <div class="flex justify-center">
      <!-- –ö–Ω–æ–ø–∫–∞ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ -->
      <a href="https://vk.com/guitarniks_nn" target="_blank" class="social-button vk ma2 no-underline flex items-center justify-center ph3 pv2 br2 bg-white shadow-1 hover-bg-light-gray">
        <img src="images/utils/vk-icon.svg" alt="–í–ö–æ–Ω—Ç–∞–∫—Ç–µ" class="dib mr2" style="width: 24px; height: 24px;">
        <span class="fw6">–ì—Ä—É–ø–ø–∞ –í–ö</span>
      </a>
      
      <!-- –ö–Ω–æ–ø–∫–∞ Telegram –≥—Ä—É–ø–ø—ã -->
      <a href="https://t.me/guitarniks_nn" target="_blank" class="social-button telegram ma2 no-underline flex items-center justify-center ph3 pv2 br2 bg-white shadow-1 hover-bg-light-gray">
        <img src="images/utils/telegram-icon.svg" alt="Telegram" class="dib mr2" style="width: 24px; height: 24px;">
        <span class="fw6">Telegram –≥—Ä—É–ø–ø–∞</span>
      </a>
      
      <!-- –ö–Ω–æ–ø–∫–∞ Telegram –∞–¥–º–∏–Ω–∞ -->
      <a href="https://t.me/mr_deprecated" target="_blank" class="social-button telegram-admin ma2 no-underline flex items-center justify-center ph3 pv2 br2 bg-white shadow-1 hover-bg-light-gray">
        <img src="images/utils/telegram-icon.svg" alt="Telegram" class="dib mr2" style="width: 24px; height: 24px;">
        <span class="fw6">–ù–∞–ø–∏—Å–∞—Ç—å –∞–¥–º–∏–Ω—É</span>
      </a>
    </div>
  </div>

</div>

<!-- ===== –°—Ç–∏–ª–∏ ===== -->
<style>
.hover-black-70:hover {
  color: #8B4513 !important;
}
.hover-black-70:hover svg {
  fill: #8B4513 !important;
}
.reg-finish {
  color: darkred;
}
.social-header {
  color: rgb(139, 90, 0);
}
.social-buttons {
  border-top: 2px solid #eee;
}
.social-button {
  color: #333;
  transition: all 0.3s ease;
  border: 1px solid #ddd;
}
.social-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
</style>
{{ end }}

